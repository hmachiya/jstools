<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>チェック柄生成器</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
        <style>
            body{
                background:#efefef;
                padding: 0px;
                margin: 0px;
                font-family: "M PLUS Rounded 1c", sans-serif;
                font-weight: 400;
                font-style: normal;
                overflow-x: clip;
                overflow-y: clip;
            }
            div#settings{
                background: rgba(255,255,255,0.9);
                border:1px solid #333333;
                border-radius: 2px;
                box-shadow: 0px 0px 10px #333333;
                position:fixed;
                right: 50px;
                bottom: 50px;
                width: 500px;
            }
            div#settings ul{
                list-style-type: none;
                padding:0px;
                margin: 0px;
                display: flex;
            }
            div#settings ul li{
                padding: 2px 10px;
                margin: 0px 3px;
                border-top: 5px solid #bbbbbb;
                background: #eeeeee;
                border-radius: 4px 4px 0px 0px;
                cursor: pointer;
            }
            div#settings ul li.active{
                border-top: 5px solid #ff9100;
                border-left: 1px solid #ff9100;
                border-right: 1px solid #ff9100;
                background: #fff6c7;
            }
            div#settings div#settings_header{
                padding: 5px 10px;
                font-weight: bold;
                background: #555;
                color: white;
                cursor: pointer;
            }
            div#settings div#controls{
                padding: 10px 10px;
                display: flex;
            }
            div#settings div.tab_container{
                margin: 5px 20px;
                margin-bottom: 20px;
            }
            div#settings div.tab_container div.tab_content{
                display: none;
                padding: 10px;
                background: #fff;
                border: 1px solid #333;
                overflow-y:scroll;
                height: 250px;
            }
            div#settings div.tab_container div.active{
                display: block;
            }
            div#color_list{
                display:flex;
                flex-wrap: wrap;
            }
            div#color_list div.linespec{
                border-radius:5px;
                margin:5px;
                padding:5px 15px;
                cursor: pointer;
                background:#eee;
            }
            div#color_list input{
                width:20px;
                height:20px;
                border: 1px solid #333;
                padding:0px;
                margin:0px;
                margin-right: 10px;
                background: none;
            }
            div.line_list{
                margin: 5px 0px;
            }
            div.line_list table{
                margin: 5px 15px;
                border-collapse: collapse;
            }
            div.line_list table tr th, div.line_list table tr td{
                padding: 5px;
                border: 1px solid #333;
                text-align: center;
            }
            div.line_list table tr td span{
                filter: invert(100%) grayscale(100%) contrast(100);
            }
            div.line_list table tr td input{
                width: 50px;
                border:none;
                padding: 0px;
            }
            div.line_list table tr td input[type="number"]:focus{
                outline: none;
            }
            div#color_selector{
                width: 200px;
            }
            div.popup_dialog{
                position: fixed;
                border: 1px solid #333;
                border-radius: 3px;
                box-shadow: 0px 0px 10px #333;
                padding: 3px;
                background: #fff;;
                display: none;
            }
            div.popup_dialog.active{
                display: block;
            }
            div#color_selector div#color_selector_list{
                display: flex;
                flex-wrap: wrap;
                margin-bottom: 4px;
            }
            div#color_selector div#color_selector_list div.linespec{
                border-radius:2px;
                margin:2px;
                padding:2px 4px;
                cursor: pointer;
                border:1px solid #333;
            }
            div#color_selector div#color_selector_controls{
                text-align: right;
            }
            div#color_selector div#color_selector_list button{
                margin:0px;
            }
            fieldset{
                border: none;
                padding: 0px;
                margin: 0px;
            }
            div#save_list{
                padding:5px;
            }
            div#save_list table{
                width: 100%;
                border-collapse: collapse;
            }
            @media screen and (max-device-width: 480px) {
                div#settings{
                    position: fixed;
                    width: 100%;
                    left:0px;
                    bottom:0px;
                    font-size:9pt;
                }
            }

        </style>
        <script>
            var color_presets=["#333333", "#41456f", "#25453d", "#46477d","#8462be","#eeeeee"]
            var lines={"vertical":[], "horizontal":[]}
            var nrepeat=20;
            var display_scale=1;
            var color_selector_agrs={"type":"", "index":-1, "index2":-1};
            var newline_specs={type:"horizontal", colors:[], widths:[]};
            var selected_line_index={"horizontal":0, "vertical":0};
            var savedConfigs = {};
            lines["horizontal"].push({
                "w": [10],
                "c": [1]
            });
            lines["horizontal"].push({
                "w": [4,2,4],
                "c": [1,5,1]
            });
            lines["horizontal"].push({
                "w": [10],
                "c": [1]
            });
            lines["horizontal"].push({
                "w": [10],
                "c": [5]
            });
            lines["horizontal"].push({
                "w": [10],
                "c": [5]
            });
            lines["horizontal"].push({
                "w": [10],
                "c": [5]
            });
            lines["horizontal"].push({
                "w": [10],
                "c": [1]
            });
            lines["vertical"].push({
                "w": [10],
                "c": [1]
            });
            lines["vertical"].push({
                "w": [10],
                "c": [5]
            });
            lines["vertical"].push({
                "w": [10],
                "c": [5]
            });
            lines["vertical"].push({
                "w": [10],
                "c": [5]
            });
            lines["vertical"].push({
                "w": [10],
                "c": [1]
            });
            lines["vertical"].push({
                "w": [4,2,4],
                "c": [1,5,1]
            });
            lines["vertical"].push({
                "w": [10],
                "c": [1]
            });

            function addLine(type, colors, widths){
                lines[type].push({"c":colors,"w":widths});
            }
            function modifyLine(type, index, colors, widths){
                if(index<0 || index>=lines[type].length){
                    return;
                }
                lines[type][index]["c"]=colors;
                lines[type][index]["w"]=widths;
            }
            function showLineLists(){
                cleanupLines();
                types=["horizontal","vertical"];
                for(var i=0;i<types.length;i++){
                    var type=types[i];
                    var resultDiv=document.getElementById(type+"_lines");
                    resultDiv.innerHTML="";
                    var linesTable=document.createElement("table");
                    var linesRow=document.createElement("tr");
                    var th=document.createElement("th");
                    linesRow.appendChild(th);
                    th=document.createElement("th");
                    th.innerHTML="番号";
                    th.width="75px";
                    linesRow.appendChild(th);
                    th=document.createElement("th");
                    th.innerHTML="色";
                    th.width="75px";
                    linesRow.appendChild(th);
                    th=document.createElement("th");
                    th.innerHTML="幅";
                    th.width="75px";
                    linesRow.appendChild(th);
                    linesTable.appendChild(linesRow);
                    for(var j=0;j<lines[type].length;j++){
                        var line=lines[type][j];
                        for(var k=0;k<line.c.length;k++){
                            var lineRow=document.createElement("tr");
                            var td=document.createElement("td");
                            if(k==0){
                                var rb=document.createElement("input");
                                rb.type="radio";
                                rb.name="rb_"+type;
                                rb.value=j;
                                td.rowSpan=line.c.length;
                                rb.ctype=type;
                                if(selected_line_index[type]==j){
                                    rb.checked=true;
                                }
                                rb.addEventListener("change",function(ev){
                                    selected_line_index[this.ctype]=document.querySelector("input[name='rb_"+this.ctype+"']:checked").value;
                                 });
                                td.appendChild(rb);
                                lineRow.appendChild(td);
                                td=document.createElement("td");
                                td.innerHTML=j;
                                td.rowSpan=line.c.length;
                                lineRow.appendChild(td);
                                td=document.createElement("td");
                            }
                            td.style.backgroundColor=color_presets[line.c[k]];
                            td.style.cursor="pointer";
                            td.className="linecolor_cell"
                            var span=document.createElement("span");
                            span.style.color=color_presets[line.c[k]];
                            span.innerHTML="No. "+line.c[k];
                            td.ctype=type;
                            td.cindex1=j;
                            td.cindex2=k;
                            td.addEventListener("click",function(ev){
                                color_selector_agrs.type=this.ctype;
                                color_selector_agrs.index1=this.cindex1;
                                color_selector_agrs.index2=this.cindex2;
                                var colorSelector=document.getElementById("color_selector");
                                colorSelector.classList.add("active");
                                var tgt_left=(ev.clientX+10);
                                var tgy_top=(ev.clientY+10);
                                var current_right=tgt_left+ colorSelector.offsetWidth;
                                var current_bottom=tgy_top+colorSelector.offsetHeight;
                                if(current_right>document.documentElement.clientWidth){
                                    tgt_left=document.documentElement.clientWidth-colorSelector.offsetWidth;
                                }
                                if(current_bottom>document.documentElement.clientHeight){
                                    tgy_top=document.documentElement.clientHeight-colorSelector.offsetHeight;
                                }
                                console.log("Color Selector Position: ", tgt_left, tgy_top);
                                colorSelector.style.left=tgt_left+"px";
                                colorSelector.style.top=tgy_top+"px";
                            });
                            td.appendChild(span);
                            lineRow.appendChild(td);
                            td=document.createElement("td");
                            td.innerHTML=line.w[k];
                            td.ctype=type;
                            td.cindex1=j;
                            td.cindex2=k;
                            td.style.cursor="pointer";
                            td.addEventListener("click",function(ev){
                                var input=document.createElement("input");
                                input.type="number";
                                input.value=this.innerHTML;
                                input.style.width="50px";
                                input.addEventListener("change",function(ev){
                                    var type=this.parentElement.ctype;
                                    var index1=this.parentElement.cindex1;
                                    var index2=this.parentElement.cindex2;
                                    lines[type][index1].w[index2]=parseInt(this.value);
                                    showLineLists();
                                    drawCheckerboard();
                                });
                                input.addEventListener("blur",function(ev){
                                    this.parentElement.innerHTML=this.value;
                                    drawCheckerboard();
                                });
                                this.innerHTML="";
                                this.appendChild(input);
                                input.focus();
                            });
                            lineRow.appendChild(td);
                            linesTable.appendChild(lineRow);
                        }

                    }
                    resultDiv.appendChild(linesTable);
                }
            }
            function switch_tab(index){
                var headers=document.querySelectorAll(".tab_header");
                for(var i=0;i<headers.length;i++){
                    if(i==index){
                        headers[i].classList.add("active");
                    }else{
                        headers[i].classList.remove("active");
                    }
                }
                var contents=document.querySelectorAll(".tab_content");
                for(var i=0;i<contents.length;i++){
                    if(i==index){
                        contents[i].classList.add("active");
                    }else{
                        contents[i].classList.remove("active");
                    }
                }
            }
            function updateColorPresets() {
                var color_list = document.getElementById('color_list');
                var color_selector_list = document.getElementById('color_selector_list');
                color_list.innerHTML = '';
                color_selector_list.innerHTML = '';
                for(var i=0; i<color_presets.length; i++) {
                    var colorDiv = document.createElement('div');
                    colorDiv.className = 'linespec';
                    colorDiv.value = i;
                    color_list.appendChild(colorDiv);
                    colorDiv.addEventListener("click",function(ev){
                        openChangeColorPresetsDialog(this.value);
                    });
                    var colorTxt=document.createElement("span");
                    colorTxt.innerHTML="No."+i;
                    var colorInput=document.createElement("input");
                    colorInput.type="color";
                    colorInput.value=color_presets[i];
                    colorInput.id="cp"+i;
                    colorInput.addEventListener("blur",function(ev){
                        applyChangeColorPreset(parseInt(this.id.replace("cp","")), this.value);
                    });
                    colorDiv.appendChild(colorInput);
                    colorDiv.appendChild(colorTxt);

                    colorDiv = document.createElement('div');
                    colorTxt = document.createElement("span");
                    colorTxt.innerHTML="No."+i;
                    colorTxt.style="color:"+color_presets[i]+"; filter: invert(100%) grayscale(100%) contrast(100);"
                    colorDiv.appendChild(colorTxt);
                    colorDiv.className = 'linespec';
                    colorDiv.value = i;
                    color_selector_list.appendChild(colorDiv);
                    colorDiv.style.backgroundColor = color_presets[i];
                    colorDiv.addEventListener("click",function(ev){
                        applyColorChange(this.value);
                    });
                    color_selector_list.appendChild(colorDiv);
                }
            }
            function applyColorChange(value){
                type=color_selector_agrs.type;
                index1=color_selector_agrs.index1;
                index2=color_selector_agrs.index2;
                lines[type][index1].c[index2]=value;
                document.getElementById("color_selector").classList.remove("active");
                showLineLists();
                drawCheckerboard();
            }
            function openChangeColorPresetsDialog(index){
                var cp=document.getElementById("cp"+index);
            }
            function applyChangeColorPreset(index,value){
                if(index>=0 && index<color_presets.length){
                    color_presets[index]=value;
                }else{
                    color_presets.push(value);
                }
                updateColorPresets();
                showLineLists();
                drawCheckerboard();
            }
            function drawCheckerboard(){
                var canvas = document.getElementById('canvas');
                canvas.width = document.documentElement.clientWidth;
                canvas.height = document.documentElement.clientHeight;
                var ctx = canvas.getContext('2d');
                var width = canvas.width;
                var height = canvas.height;
                var centerX = canvas.width / 2;
                var centerY = canvas.height / 2;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FFFFFF';
                xpos=0;
                ypos=0;
                checker_width = 0;
                checker_height = 0;
                for(var i=0; i<lines["horizontal"].length; i++) {
                    for(var j=0; j<lines["horizontal"][i].w.length; j++) {
                        checker_height += lines["horizontal"][i].w[j] * nrepeat * display_scale;
                    }
                }
                for(var i=0; i<lines["vertical"].length; i++) {
                    for(var j=0; j<lines["vertical"][i].w.length; j++) {
                        checker_width += lines["vertical"][i].w[j] * nrepeat * display_scale;
                    }
                }
                if(checker_width === 0 || checker_height === 0) {
                    return;
                }
                var cell_height=0;
                var cell_width=0;
                for(var ix=0; ix<lines["horizontal"].length*nrepeat; ix++) {
                    xpos=0;
                    for(var iy=0; iy<lines["vertical"].length*nrepeat; iy++) {
                        cellh=lines["horizontal"][ix%lines["horizontal"].length];
                        cellv=lines["vertical"][iy%lines["vertical"].length];
                        cell_height = 0;
                        cell_width = 0;
                        for(var j=0; j<cellh.w.length; j++) {
                            cell_height += cellh.w[j] * display_scale;
                        }
                        for(var j=0; j<cellv.w.length; j++) {
                            cell_width += cellv.w[j] * display_scale;
                        }
                        if((ix+iy) % 2 === 0) {
                            //horizontal
                            var cell_inner_pos=0;
                            for(var j=0; j<cellh.c.length; j++) {
                                ctx.fillStyle =color_presets[cellh.c[j]];
                                ctx.fillRect(centerX - checker_width/2 + xpos, centerY - checker_height/2 + ypos + cell_inner_pos, cell_width, cellh.w[j] * display_scale);
                                cell_inner_pos += cellh.w[j] * display_scale;
                            }
                        }else{
                            //vertical
                            var cell_inner_pos=0;
                            for(var j=0; j<cellv.c.length; j++) {
                                ctx.fillStyle =color_presets[cellv.c[j]];
                                ctx.fillRect(centerX - checker_width/2 + xpos + cell_inner_pos, centerY - checker_height/2 + ypos, cellv.w[j] * display_scale, cell_height);
                                cell_inner_pos+=cellv.w[j] * display_scale;
                            }
                        }
                        xpos+=cell_width;
                    }
                    ypos+=cell_height;
                }
            }
            function closeDialogs(){
                var colorSelector=document.getElementById("color_selector");
                if(colorSelector.classList.contains("active")){
                    colorSelector.classList.remove("active");
                }
            }
            function addNewLine(type){
                var colors=[0];
                var widths=[10];
                lines[type].push({"c":colors,"w":widths});
                showLineLists();
                drawCheckerboard();
            }
            function addNewSubLine(type){
                var index=document.querySelector("input[name='rb_"+type+"']:checked").value;
                if(index>=0 && index<lines[type].length){
                    lines[type][index].c.push(0);
                    lines[type][index].w.push(10);
                }
                showLineLists();
                drawCheckerboard();
            }
            function cleanupLines(){
                //remove lines with empty colors or widths
                //also remove sublines with zero width
                new_list={"horizontal":[], "vertical":[]};
                for(var type in lines){
                    for(var i=0;i<lines[type].length;i++){
                        var temp_widths=[];
                        var temp_colors=[];
                        var line=lines[type][i];
                        for(var j=0;j<line.c.length;j++){
                            if(line.w[j]>0){
                                temp_colors.push(line.c[j]);
                                temp_widths.push(line.w[j]);
                            }
                        }
                        if(temp_colors.length>0 && temp_widths.length>0){
                            new_list[type].push({"c":temp_colors, "w":temp_widths});
                        }
                    }
                }
                lines=new_list;
            }
            function removeSubLine(type, index1, index2){
                if(index1<0 || index1>=lines[type].length || index2<0 || index2>=lines[type][index1].c.length){
                    return;
                }
                lines[type][index1].c.splice(index2, 1);
                lines[type][index1].w.splice(index2, 1);
                if(lines[type][index1].c.length === 0){
                    removeLine(type, index1);
                }
                showLineLists();
                drawCheckerboard();
            }
            function removeLine(type, index){
                if(index<0 || index>=lines[type].length){
                    return;
                }
                lines[type].splice(index, 1);
                showLineLists();
                drawCheckerboard();
            }
            function moveLine(type, direction){
                var from_index=document.querySelector("input[name='rb_"+type+"']:checked").value;
                from_index=parseInt(from_index);
                to_index=from_index+direction;
                if(to_index<0 || to_index>=lines[type].length){
                    return;
                }
                //swap lines
                var temp=lines[type][from_index];
                lines[type][from_index]=lines[type][to_index];
                lines[type][to_index]=temp;
                selected_line_index[type]=to_index;
                showLineLists();
                drawCheckerboard();
            }
            function makeCurrentConfigJSON(save_name){
                var config = {
                    "save_name": save_name,
                    "color_presets": color_presets,
                    "lines": lines,
                    "nrepeat": nrepeat,
                    "display_scale": display_scale
                };
                return config;
            }
            function loadLocalStorage(){
                savedConfigs = JSON.parse(localStorage.getItem("checker_pattern_configs") || "{}");
                var saveList = document.getElementById("save_list");
                saveList.innerHTML = '';
                savedItemNames = Object.keys(savedConfigs);
                if(savedItemNames.length === 0){
                    saveList.innerHTML = "<div>保存された設定はありません。</div>";
                }else{
                    var table = document.createElement("table");
                    for(var i=0; i<savedItemNames.length; i++){
                        var row = document.createElement("tr");
                        var cell = document.createElement("td");
                        cell.innerHTML = savedItemNames[i];
                        row.appendChild(cell);
                        cell = document.createElement("td");
                        var loadBtn = document.createElement("button");
                        loadBtn.innerHTML = "読込";
                        var delBtn = document.createElement("button");
                        delBtn.innerHTML = "削除";
                        delBtn.target = savedItemNames[i];
                        delBtn.addEventListener("click", function(ev){
                            removeSavedConfig(this.target);
                        });
                        loadBtn.target = savedItemNames[i];
                        loadBtn.addEventListener("click", function(ev){
                            loadConfig(this.target);
                        });
                        var saveBtn=document.createElement("button");
                        saveBtn.innerHTML = "上書保存";
                        saveBtn.target = savedItemNames[i];
                        saveBtn.addEventListener("click", function(ev){
                            saveCurrentSettingsAs(this.target);
                        });
                        cell.appendChild(loadBtn);
                        cell.appendChild(saveBtn);
                        cell.appendChild(delBtn);
                        cell.width = "250px";
                        row.appendChild(cell);
                        table.appendChild(row);
                    }
                    saveList.appendChild(table);
                }
            }
            function loadConfig(save_name){
                if(savedConfigs[save_name]){
                    color_presets = savedConfigs[save_name].color_presets;
                    lines = savedConfigs[save_name].lines;
                    nrepeat = savedConfigs[save_name].nrepeat;
                    display_scale = savedConfigs[save_name].display_scale;
                    updateColorPresets();
                    showLineLists();
                    drawCheckerboard();
                }else{
                    alert("指定された設定は存在しません。");
                }
            }
            function removeSavedConfig(save_name){
                delete savedConfigs[save_name];
                localStorage.setItem("checker_pattern_configs", JSON.stringify(savedConfigs));
                loadLocalStorage();
            }
            function saveCurrentSettingsAs(save_name){
                if(savedConfigs.length==0){
                    savedConfigs = {};
                }
                savedConfigs[save_name] = makeCurrentConfigJSON(save_name);
                localStorage.setItem("checker_pattern_configs", JSON.stringify(savedConfigs));
                //document.getElementById("save_debug").innerHTML = "設定を保存しました: " + save_name +"<br />" + JSON.stringify(savedConfigs);
                loadLocalStorage();
            }
            function saveCurrentSettingsBtnClicked(){
                var saveNameInput = document.getElementById("save_name");
                var saveName = saveNameInput.value.trim();
                saveCurrentSettingsAs(saveName);
                saveNameInput.value = "";
            }
            function generateLink(){
                var config = makeCurrentConfigJSON("current");
                var jsonString = JSON.stringify(config);
                var encodedString = encodeURIComponent(jsonString);
                var link="https://mchhd.github.io/jstools/checker_pattern.html?config=" + encodedString;
                navigator.clipboard.writeText(link);
            }
            document.addEventListener("DOMContentLoaded", function(ev){
                updateColorPresets();
                showLineLists();
                drawCheckerboard();
                loadLocalStorage();
                document.getElementById("container").addEventListener("click", function(ev){
                    if(!ev.target.closest("#color_selector") && !ev.target.closest(".linecolor_cell")){
                        closeDialogs();
                    }
                });
                document.getElementById("settings_header").addEventListener("click", function(ev){
                    var settingsContainer = document.getElementById("settings_container");
                    if(settingsContainer.style.display === "none"){
                        settingsContainer.style.display = "block";
                        this.innerHTML = "▼ 設定";
                    } else {
                        settingsContainer.style.display = "none";
                        this.innerHTML = "▲ 設定";
                    }
                });
            });

        </script>
    </head>
    <body>
        <div id="container">
            <div id="output">
                <canvas id="canvas" width="600" height="600"></canvas>
            </div>

            <div id="settings">
                <div id="settings_header">
                    ▼ 設定
                </div>
                <div id="settings_container">
                    <div id="controls">
                        <button onclick="showLineLists();drawCheckerboard();">再表示</button>
                        <select onchange="display_scale=parseFloat(this.value); drawCheckerboard();">
                            <option value="0.1">10%</option>
                            <option value="0.25">25%</option>
                            <option value="0.5">50%</option>
                            <option value="0.75">75%</option>
                            <option value="1" selected>100%</option>
                            <option value="2">200%</option>
                            <option value="4">400%</option>
                            <option value="8">800%</option>
                            <option value="16">1600%</option>
                        </select>
                    </div>
                    <div class="tab_container">
                        <ul>
                            <li class="tab_header active" onclick="switch_tab(0)">色</li>
                            <li class="tab_header" onclick="switch_tab(1)">横ライン</li>
                            <li class="tab_header" onclick="switch_tab(2)">縦ライン</li>
                            <li class="tab_header" onclick="switch_tab(3)">保存</li>
                        </ul>
                        <div class="tab_content active">
                        <fieldset>
                            <div id="color_list">
                            </div>
                        </fieldset>
                        </div>
                        <div class="tab_content">
                            <fieldset>
                                <div id="horizontal_lines" class="line_list">
                                </div>
                                <div id="hline_controls">
                                    <button onclick="moveLine('horizontal',-1)"">▲</button>
                                    <button onclick="moveLine('horizontal',+1)">▼</button>
                                    <button onclick="addNewLine('horizontal')">新しいラインを追加</button>
                                    <button onclick="addNewSubLine('horizontal')">新しいサブラインを追加</button>
                                </div>
                            </fieldset>
                        </div>
                        <div class="tab_content">
                            <fieldset>
                                <div id="vertical_lines" class="line_list">
                                </div>
                                <div id="vline_controls">
                                    <button onclick="moveLine('vertical',-1)"">▲</button>
                                    <button onclick="moveLine('vertical',1)">▼</button>
                                    <button onclick="addNewLine('vertical')">新しいラインを追加</button>
                                    <button onclick="addNewSubLine('vertical')">新しいサブラインを追加</button>
                                </div>
                            </fieldset>
                        </div>
                        <div class="tab_content">
                            <fieldset>
                                <div id="save_list"></div>
                                <div id="save_controls">
                                    <input type="text" id="save_name" placeholder="保存名" />
                                    <button id="save_button" onclick="saveCurrentSettingsBtnClicked()">保存</button>
                                    <div id="save_debug"></div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
            </div>
            <div id="color_selector" class="popup_dialog" onblur="closeDialogs()">
                <div id="color_selector_list"></div>
                <div id="color_selector_controls">
                    <button onclick="document.getElementById('color_selector').classList.remove('active');">閉じる</button>
            </div>
        </div>
    </body>
</html>